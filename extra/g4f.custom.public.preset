--local base = "https://api.gpt4free.workers.dev/custom/"
local base = "https://g4f.space/custom/"

local Common = ...
apibase=function(cur)
  local client = Common.restapi.Plain(nil, "https://g4f.space/custom/api")
  local servers = assert(client:request("/servers/public")).servers
  local items = {}
  local hk = Common.utils.HK.new(". ")
  for _,server in ipairs(servers) do
    local apibase = base..server.id
    items[#items+1] = {
      text=hk:iter()..server.label,
      selected=apibase==cur,
      apibase=apibase,
    }
  end
  local props = {
    Title="gpt4free custom servers (public)", Bottom="Enter to choose",
    Id=win.Uuid"6D536BD0-5C41-445F-B6EE-AAF5079044C6",
  }
  repeat
    local choice,idx = far.Menu(props,items,"F3")
    if choice then
      if choice.apibase then
        return choice.apibase
      end
      require"le"(servers[idx])
      props.SelectIndex = idx
    end
  until not choice
end

apikey=win.GetEnv"G4F_API_KEY"
