name = "Antigravity API"

local U = ...
if not U.restapi then return end

local Antigravity = U.restapi.GoogleInternal:class("Antigravity", {
  client_id="1071006060591-tmhssin2h21lcre235vtolojh4g403ep.apps.googleusercontent.com",
  client_secret="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",
  headers={ ["User-Agent"]="antigravity/1.13.3 windows/amd64" }, --https://antigravity.google/changelog
})
local applyParams = _import("Gemini.lua.cfg", nil, Antigravity)
if not applyParams then return end

url = "https://antigravity.google/"
predefined.api_base = {
  "",
  --"https://autopush-cloudcode-pa.sandbox.googleapis.com/v1internal",
  "https://daily-cloudcode-pa.sandbox.googleapis.com/v1internal",
  "https://cloudcode-pa.googleapis.com/v1internal",
}
predefined.api_key = nil
predefined.model = "gemini-2.5-flash"

return applyParams,

--https://antigravity.google/docs/models
--https://antigravity.google/docs/plans -- rate limits
function (data) -- getModels
  local client = Antigravity(data.apikey, data.api_base)
  local models = assert(client:models())
  models.filterFn = function(model)
    return model.recommended
  end
  models.keyId = "name"
  return models
end,

function () --authFn
  local _export = {json=U.json, openUrl=U.utils.openUrl}
  local oauth = U.utils.loadMoon("oauth_google.moon.1", _export) "oauth_google"
  local title,msg = "Authorization",nil
  return oauth("antigravity", function(line)
    msg = msg and msg.."\n" or ""
    msg = msg..line
    far.Message(msg,title,"","l")
  end)
end
