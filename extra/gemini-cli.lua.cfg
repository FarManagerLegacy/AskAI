name = "Gemini CLI"
url = "https://github.com/google-gemini/gemini-cli"
--https://geminicli.com/docs/quota-and-pricing/#free-usage
--https://developers.google.com/gemini-code-assist/resources/quotas#quotas-for-agent-mode-gemini-cli
--https://github.com/google-gemini/gemini-cli/blob/main/docs/quota-and-pricing.md#log-in-with-google-gemini-code-assist-for-individuals

--https://geminicli.com/docs/changelogs/
--npm i -g @google/gemini-cli
exe = "gemini"

local HOME = _isWindows and _env"USERPROFILE" or _env"HOME"
config = _pathjoin(HOME, ".gemini", "settings.json")

predefined = {
  model={
    "gemini-2.5-flash",
    "gemini-2.5-flash-lite",
    "gemini-2.5-pro",
    "gemini-3-flash-preview",
    "gemini-3-pro-preview",
    "gemini-2.0-flash",
  },
  extra={
    "",
    "--debug",
  },
}

--https://geminicli.com/docs/cli/headless/#configuration-options
return function (session, model, role, yolo, extra)
  return _pipeOut(exe, _context) {
    session and "--resume latest" or "",
    _optional("--model", model),
    yolo and "--yolo" or "",
    _optional(extra),
    _optional(role),
  }
end
